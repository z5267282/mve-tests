#!/bin/dash

# add flags to support config changes
# note that a default config is supplied and then the generator is run

# flags:
# --recent

recent=false

for arg in "$@"
do
    case "$arg" in
        --recent) recent=true ;;
    esac
done

export CONFIG=testing
export MVE_CONFIGS='../configs'

# let us run scripts in current folder
export PATH="$PATH:."

root="$(pwd)"

[ -d configs ] && rm -r configs
mkdir configs

[ -d outputs ] && rm -r outputs
mkdir outputs

cd configs
mkdir $CONFIG
cd $CONFIG
for dir in errors history queue
do
    mkdir $dir
done
echo '[]' > remaining.json
cat << EOF > config.json
{
    "SOURCE": ["..", "..", "videos"],
    "RENAMES": [".."],
    "DESTINATION": ["..", "outputs"],

    "TESTING": true,
    "RECENT": $recent 
}
EOF
cd ../..

cp -r ../../mve/src .
cd src
python3 generator.py $CONFIG > /dev/null
cd "$root"
